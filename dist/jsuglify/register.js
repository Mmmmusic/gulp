var ema=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,phone=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/,users=/^[a-zA-Z0-9_]{4,15}$/,user=document.getElementById("user"),pwd=document.getElementById("pwd"),code=document.getElementById("code"),flag=!1,timer=null;user.oninput=function(){flag=0!=user.value.length&&0!=pwd.value.length&&4==code.value.length?($(".btn").css({opacity:1}),!0):($(".btn").css({opacity:.6}),!1)},pwd.oninput=function(){flag=0!=user.value.length&&0!=pwd.value.length&&4==code.value.length?($(".btn").css({opacity:1}),!0):($(".btn").css({opacity:.6}),!1)},code.oninput=function(){flag=0!=user.value.length&&0!=pwd.value.length&&4==code.value.length?($(".btn").css({opacity:1}),!0):($(".btn").css({opacity:.6}),!1)},flag=0!=user.value.length&&0!=pwd.value.length&&4==code.value.length?($(".btn").css({opacity:1}),!0):($(".btn").css({opacity:.6}),!1);var ctx=can.getContext("2d");function random(e,t){return Math.floor(Math.random()*(t-e)+1)+e}var res="";function draw(){res="",ctx.clearRect(0,0,300,150);for(var e=0;e<50;e++)ctx.beginPath(),ctx.strokeStyle="rgba("+random(0,255)+","+random(0,255)+","+random(0,255)+","+random(3,9)/10+")",ctx.moveTo(random(0,300),random(-10,160)),ctx.lineTo(random(0,300),random(-10,160)),ctx.stroke();for(e=0;e<25;e++)ctx.beginPath(),ctx.fillStyle="rgba("+random(0,255)+","+random(0,255)+","+random(0,255)+","+random(1,6)/10+")",ctx.arc(random(0,310),random(0,150),random(0,6),0,2*Math.PI),ctx.fill();for(e=0;e<4;e++){var t="0123456789abcdefghijklmnopqrstuvwxyz"[random(0,35)];res+=t,ctx.textBaseline="hanging",ctx.fillStyle="rgba("+random(0,255)+","+random(0,255)+","+random(0,255)+",1)",ctx.font=random(50,100)+"px 微软雅黑",ctx.fillText(t,50+50*e,50)}}draw(),$("#can").tap(function(){draw()}),$(".btn").tap(function(){if(flag)if(res==code.value)if(alert("验证码正确"),ema.test(user.value)||phone.test(user.value)||users.test(user.value)){console.log("符合规范");var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status)if("yes"==t.responseText){console.log("用户名未被使用");var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&("yes"===e.responseText?(alert("注册成功"),window.location.href="login.html",user.value="",code.value=""):alert("注册失败，请检查网络原因"))},e.open("GET","php/add.php?username="+user.value+"&password="+pwd.value),e.send()}else console.log("用户名已存在")},t.open("GET","php/isNo.php?username="+user.value),t.send()}else alert("不符合规范,用户名最少六位");else alert("验证码错误"),draw()});